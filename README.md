### 介绍
PUSimulator是基于BVCSP实现的设备模拟器项目。  
目的：
* 开放源码用于供BVCSP使用者了解如何开发设备端。
* 用于测试BVCSP功能。
* 用于模拟设备测试平台性能。

### 目录说明
```
bin     生成/调试 目录
build   sln工程文件/编译临时文件 目录
include BVCSP库相关头文件 目录
lib     BVCSP库相关dll/lib 目录
src     模拟器源码 目录
linux   linux下编译以及相关lib/头文件 目录
```
> 正常情况下，您只需根据情况修改src里的代码，不需要修改src中子目录里的代码，他们是对bvcsp接口的封装。

### Linux编译说明

通过linux目录下makefile编译，生成可执行文件PUSimulator。
> 注意：编译前，请先准备好libBVCSP.so及其依赖库。
在make命令中传入需要进行编译的linux平台，例如 make OS=x86。

### Linux运行

将可执行文件PUSimulator与相关依赖库拷贝至对应linux系统中运行。

### Windows编译说明

项目是Windows Visual Studio 2010项目，推荐使用Visual Studio 2010编译。  
项目工程文件在build目录中。  

### Windows运行

1. 修改bin目录下pusimulator.ini配置文件。重点：id（设备ID号）ip（上线服务器地址） port（上线服务器端口）
2. 自动拷贝文件运行：直接双击bin目录下的run.bat运行。  
3. 手动拷贝文件运行：将lib目录下的dll文件拷贝到bin目录下。 双击PUSimulator.exe 运行。
> BVCSP库依赖msvcr100.dll，msvcp100.dll（没有vs2010开发环境，可以安装运行环境）。
PUSimulator.exe 是开放源码的，具体依赖的运行环境，需要根据您的开发环境确定。 
BVCSP是收费库，需要认证后，才能上线服务器。认证需要联系销售人员（需提供auth_code，见打印输出）。

### 开发流程
1. 设置日志回调接口。
2. 初始化库。
3. 认证。
4. 实现命令，通道等相关对象虚函数。
5. 设置设备信息，通道对象。
6. 上线服务器。 
7. 下线。
8. 释放库。

### 初始化库
* 使用库内部线程，则调用者不需要调用BVCSP_HandleEvent接口。
> 注意库回调来自库内部线程，小心处理同步问题，防止死锁。

* 使用库外部线程，则需要调用者“在一个固定的线程内“调用BVCSP_HandleEvent接口。
> 注意 必须等BVCSP_HandleEvent被调用后（库内部确定工作线程已启动），才能调用其它接口，否则会收到回复”-65532“。

### 认证
BVCSP是收费库，需要认证后，才能上线服务器。认证需要联系销售人员（需提供auth_code）。  
认证相关代码在 auth.cpp中，需要您做如下修改：

* 硬件信息回调接口中，填写您的真实设备硬件信息。
* Auth接口中，填写您申请的开发者密钥信息（需要联系销售人员分配）。
> 相同的硬件信息会被认为是同一台设备，认证信息绑定硬件信息，同一个硬件信息平台同时只允许一个有效。

### 设置设备信息，通道对象
设备/通道信息设置在 loginout.cpp中，需要您做如下修改：
* 修改config.cpp，实现配置保存和读取功能（默认为windows下.ini配置文件）。
* loginout.cpp中login接口，实现设备/通道信息注册!!!!

### 上线/下线服务器
loginout.cpp 中已经实现，可以根据需求修改。

### GPS 
GPS相关功能实现在gps.*中，根据注释实现相关类虚函数接口，即可以支持一下功能。
* GPS通道支持。
* 设置GPS通道名称支持。
* 查询GPS定位数据命令支持。
* 查询/设置 GPS 配置支持。

### 串口（TSP）
串口相关功能实现在tsp.*中，根据注释实现相关类虚函数接口，即可以支持一下功能。
* 串口通道支持。
* 设置串口通道名称支持。
* 查询/设置 串口属性支持。

### 音视频

音视频相关功能实现在media.*中，根据注释实现相关类虚函数接口，即可以支持一下功能。
* 音视频通道支持。能力上报；音视频数据（可变类型）采集、发送；
* 设置音视频通道名称支持。
* 云台控制支持。